import{k as T,r as c,l as z,m as D,o as k,g as O,h as U,n as $,p as E,q as L,t as M,u as N,d as R,v as j,x as A,y as Q,z as y,f as i,A as I,B as V,C as H,D as J,E as K,F as W}from"./index-CpBwszWR.js";import{v as G,Q as w,a as q}from"./QBtn-CkU4_ovh.js";import{a as X,Q as F}from"./QInput-BcXABmdv.js";import{a as Y}from"./index-t--hEgTQ.js";const Z=T({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(d,{slots:b,emit:p}){const s=O(),l=c(null);let u=0;const n=[];function f(t){const o=typeof t=="boolean"?t:d.noErrorFocus!==!0,e=++u,g=(a,r)=>{p(`validation${a===!0?"Success":"Error"}`,r)},C=a=>{const r=a.validate();return typeof r.then=="function"?r.then(m=>({valid:m,comp:a}),m=>({valid:!1,comp:a,err:m})):Promise.resolve({valid:r,comp:a})};return(d.greedy===!0?Promise.all(n.map(C)).then(a=>a.filter(r=>r.valid!==!0)):n.reduce((a,r)=>a.then(()=>C(r).then(m=>{if(m.valid===!1)return Promise.reject(m)})),Promise.resolve()).catch(a=>[a])).then(a=>{if(a===void 0||a.length===0)return e===u&&g(!0),!0;if(e===u){const{comp:r,err:m}=a[0];if(m!==void 0&&console.error(m),g(!1,r),o===!0){const P=a.find(({comp:B})=>typeof B.focus=="function"&&G(B.$)===!1);P!==void 0&&P.comp.focus()}}return!1})}function h(){u++,n.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function v(t){t!==void 0&&E(t);const o=u+1;f().then(e=>{o===u&&e===!0&&(d.onSubmit!==void 0?p("submit",t):t?.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function _(t){t!==void 0&&E(t),p("reset"),L(()=>{h(),d.autofocus===!0&&d.noResetFocus!==!0&&x()})}function x(){X(()=>{if(l.value===null)return;(l.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||l.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||l.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(l.value.querySelectorAll("[tabindex]"),o=>o.tabIndex!==-1))?.focus({preventScroll:!0})})}M(N,{bindComponent(t){n.push(t)},unbindComponent(t){const o=n.indexOf(t);o!==-1&&n.splice(o,1)}});let S=!1;return z(()=>{S=!0}),D(()=>{S===!0&&d.autofocus===!0&&x()}),k(()=>{d.autofocus===!0&&x()}),Object.assign(s.proxy,{validate:f,resetValidation:h,submit:v,reset:_,focus:x,getValidationComponents:()=>n}),()=>U("form",{class:"q-form",ref:l,onSubmit:v,onReset:_},$(b.default))}}),ee={class:"login_form_area"},te={class:"title"},oe={class:"verification"},ae={class:"codeBox"},se={class:"btn_group"},ne=R({__name:"LoginForm",setup(d){const b=j(),p=c("請先登入"),s=c({username:"actinc",password:"actinc",verification:""}),l=c(""),u=c(""),n=c(!1),f=c(!0),h=c(""),v=(t=4)=>{const o="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";let e="";for(let g=0;g<t;g++)e+=o.charAt(Math.floor(Math.random()*o.length));h.value=e},_=()=>{v()},x=()=>{try{const t="https://dev.tapgo.cc/test/auth/login",o={username:s.value.username,password:s.value.password};Y.post(t,o).then(e=>{if(e.status===200){const g=[{id:e.data.id,username:e.data.username,token:e.data.token}];localStorage.setItem("token",e.data.token);const C=JSON.stringify(g);localStorage.setItem("User",C),b.push({path:"/admin/index"})}}).catch(e=>{})}catch(t){console.log(t)}},S=()=>{l.value="",u.value="",n.value=!1};return k(()=>{v()}),(t,o)=>(Q(),A("div",ee,[y("div",te,[y("b",null,I(p.value),1)]),i(Z,{onSubmit:x,onReset:S,class:"q-form"},{default:V(()=>[i(F,{modelValue:s.value.username,"onUpdate:modelValue":o[0]||(o[0]=e=>s.value.username=e),label:"您的帳號 *","lazy-rules":"",rules:[e=>e&&e.length>0||"請輸入您的帳號!"]},{prepend:V(()=>[i(w,{name:"account_circle"})]),_:1},8,["modelValue","rules"]),i(F,{class:"password",modelValue:s.value.password,"onUpdate:modelValue":o[2]||(o[2]=e=>s.value.password=e),type:f.value?"password":"text",label:"您的密碼 *","lazy-rules":"",rules:[e=>e!==null&&e!==""||"請輸入您的密碼"]},{prepend:V(()=>[i(w,{name:"lock"})]),append:V(()=>[i(w,{name:f.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[1]||(o[1]=e=>f.value=!f.value)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),y("div",oe,[i(F,{type:"text",modelValue:s.value.verification,"onUpdate:modelValue":o[3]||(o[3]=e=>s.value.verification=e),label:"驗證碼 *","lazy-rules":"",rules:[e=>e!==null&&e!==""||"請輸入驗證碼"]},null,8,["modelValue","rules"]),y("div",ae,I(h.value),1),y("span",{onClick:_,class:"material-icons"}," autorenew ")]),y("div",se,[i(q,{label:"重置",type:"reset",color:"primary",flat:""}),i(q,{label:"登入",type:"submit",color:"primary"})])]),_:1})]))}}),de=R({__name:"IndexPage",setup(d){const b=H(),{showSignOut:p}=J(b),{changeTitleTag:s,getPageClass:l,setHtmlLang:u}=b,n=c("請先登入"),f=c("pageLogin");return localStorage.setItem("pageClass",f.value),K(()=>{l()}),k(()=>{s(n.value),u(),p.value=!1}),(h,v)=>(Q(),A(W,null,[i(ne),v[0]||(v[0]=y("div",{class:"footer"},"黃瑄惠 2025/03/24",-1))],64))}});export{de as default};
